<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ëŒë¦¼íŒ ê²Œì„</title>
<style>
  body {
    text-align: center;
    font-family: Arial, sans-serif;
    background: #f3f3f3;
    padding-top: 50px;
  }
  canvas {
    border: 5px solid #444;
    border-radius: 50%;
    box-shadow: 0 0 20px #aaa;
  }
  #container {
    position: relative;
    width: 400px;
    margin: 0 auto;
  }
  #pointer {
    position: absolute;
    top: -18px;  /* í™”ì‚´í‘œ ìœ„ì¹˜ë¥¼ ì¡°ê¸ˆ ë‚´ë¦¼ */
    left: 50%;
    margin-left: -15px;
    width: 0;
    height: 0;
    border-left: 15px solid transparent;
    border-right: 15px solid transparent;
    border-top: 30px solid red; /* ìœ„ìª½ í™”ì‚´í‘œ */
    z-index: 10;
  }
  #result {
    margin-top: 30px;
    font-size: 28px;
    font-weight: bold;
    color: #333;
    min-height: 60px;
  }
  #spinBtn {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 18px;
    cursor: pointer;
  }
</style>
</head>
<body>
  <h1>ğŸ¯ ëŒë¦¼íŒ ê²Œì„</h1>
  <div id="container">
    <canvas id="wheel" width="400" height="400"></canvas>
    <div id="pointer"></div>
  </div>
  <button id="spinBtn">ëŒë¦¬ê¸°!</button>
  <div id="result"></div>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const resultDiv = document.getElementById("result");
const spinBtn = document.getElementById("spinBtn");

const segments = ["1,000P", "3,000P", "5,000P", "10,000P", "ì¹˜í‚¨"];
const colors = ["#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF"];

const centerX = canvas.width / 2;
const centerY = canvas.height / 2;
const radius = 180;

let startAngle = 0;
const arc = (2 * Math.PI) / segments.length;
let isSpinning = false;
let spinTimeout;
let spinAngleStart = 0;
let spinTime = 0;
let spinTimeTotal = 0;

function drawSegment(index, angle) {
  ctx.beginPath();
  ctx.fillStyle = colors[index];
  ctx.moveTo(centerX, centerY);
  ctx.arc(centerX, centerY, radius, angle, angle + arc);
  ctx.lineTo(centerX, centerY);
  ctx.fill();

  ctx.save();
  ctx.fillStyle = "#fff";
  ctx.translate(centerX, centerY);
  ctx.rotate(angle + arc / 2);

  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.font = "bold 20px Arial";
  ctx.fillText(segments[index], radius * 0.65, 0);

  ctx.restore();
}

function drawWheel() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let i = 0; i < segments.length; i++) {
    drawSegment(i, startAngle + i * arc);
  }
}

function spin() {
  spinAngleStart = Math.random() * 30 + 40; // ì´ˆê¸° ê°ë„ í¬ê²Œ(ë¹ ë¥´ê³  ë§ì´ ëŒê²Œ)
  spinTime = 0;
  spinTimeTotal = (Math.random() * 2 + 3) * 1000; // 3~5ì´ˆ ëŒë¦¼
  rotateWheel();
}

function rotateWheel() {
  spinTime += 30;
  if (spinTime >= spinTimeTotal) {
    stopRotateWheel();
    return;
  }
  let spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
  startAngle += (spinAngle * Math.PI) / 180;
  drawWheel();
  spinTimeout = setTimeout(rotateWheel, 30);
}

function stopRotateWheel() {
  clearTimeout(spinTimeout);
  // í™”ì‚´í‘œ ìœ„ì¹˜ë¥¼ ë°˜ì˜í•´ì„œ ê³„ì‚° (270ë„ -> 265ë„ ë³´ì •)
  const degrees = (startAngle * 180) / Math.PI + 265;  
  const arcd = (arc * 180) / Math.PI;
  let index = Math.floor((360 - (degrees % 360)) / arcd);
  index = index % segments.length;
  const selected = segments[index];
  resultDiv.textContent = `ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ë‹¹ì²¨: ${selected}`;
}

function easeOut(t, b, c, d) {
  const ts = (t /= d) * t;
  const tc = ts * t;
  return b + c * (tc + -3 * ts + 3 * t);
}

spinBtn.addEventListener("click", () => {
  if (!isSpinning) {
    isSpinning = true;
    resultDiv.textContent = "";
    spin();
    setTimeout(() => {
      isSpinning = false;
    }, 6000);
  }
});

drawWheel();
</script>
</body>
</html>
