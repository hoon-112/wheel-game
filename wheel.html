<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>돌림판 게임</title>
<style>
  body {
    text-align: center;
    font-family: Arial, sans-serif;
    background: #f3f3f3;
    padding-top: 50px;
  }
  canvas {
    border: 5px solid #444;
    border-radius: 50%;
    box-shadow: 0 0 20px #aaa;
  }
  #container {
    position: relative;
    width: 400px;
    margin: 0 auto;
  }
  #pointer {
    position: absolute;
    top: -20px;  /* 위로 올림 */
    left: 50%;
    margin-left: -15px; /* 화살표 너비 절반 */
    width: 0;
    height: 0;
    border-left: 15px solid transparent;
    border-right: 15px solid transparent;
    border-top: 30px solid red; /* 방향 반대로 변경 */
    z-index: 10;
  }
  #result {
    margin-top: 30px;
    font-size: 28px;
    font-weight: bold;
    color: #333;
    min-height: 60px;
  }
  #spinBtn {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 18px;
    cursor: pointer;
  }
  /* 폭죽 효과 */
  .firework {
    position: absolute;
    width: 150px;
    height: 150px;
    pointer-events: none;
    border-radius: 50%;
    animation: explode 1s ease-out forwards;
  }
  @keyframes explode {
    0% {
      opacity: 1;
      transform: scale(0.3);
      box-shadow:
        0 -30px 20px #f00,
        21px -21px 20px #ff0,
        30px 0 20px #0f0,
        21px 21px 20px #0ff,
        0 30px 20px #00f,
        -21px 21px 20px #f0f,
        -30px 0 20px #fff,
        -21px -21px 20px #ffa500;
    }
    100% {
      opacity: 0;
      transform: scale(1.5);
      box-shadow: none;
    }
  }
</style>
</head>
<body>
  <h1>🎯 돌림판 게임</h1>
  <div id="container">
    <canvas id="wheel" width="400" height="400"></canvas>
    <div id="pointer"></div>
  </div>
  <button id="spinBtn">돌리기!</button>
  <div id="result"></div>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const resultDiv = document.getElementById("result");
const spinBtn = document.getElementById("spinBtn");

const segments = ["1,000P", "3,000P", "5,000P", "10,000P", "치킨"];
const colors = ["#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF"];

const centerX = canvas.width / 2;
const centerY = canvas.height / 2;
const radius = 180;

let startAngle = 0;
let arc = (2 * Math.PI) / segments.length;
let isSpinning = false;
let spinTimeout;
let spinAngleStart = 0;
let spinTime = 0;
let spinTimeTotal = 0;

function drawSegment(index, angle) {
  ctx.beginPath();
  ctx.fillStyle = colors[index];
  ctx.moveTo(centerX, centerY);
  ctx.arc(centerX, centerY, radius, angle, angle + arc);
  ctx.lineTo(centerX, centerY);
  ctx.fill();

  ctx.save();
  ctx.fillStyle = "#fff";
  ctx.translate(centerX, centerY);
  ctx.rotate(angle + arc / 2);

  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.font = "bold 20px Arial";
  ctx.fillText(segments[index], radius * 0.5, 0);  // 텍스트 위치 가운데로 조정

  ctx.restore();
}

function drawWheel() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let i = 0; i < segments.length; i++) {
    drawSegment(i, startAngle + i * arc);
  }
}

function spin() {
  spinAngleStart = Math.random() * 10 + 10;
  spinTime = 0;
  spinTimeTotal = (Math.random() * 3 + 4) * 1000; // 4~7초 돌림
  rotateWheel();
}

function rotateWheel() {
  spinTime += 30;
  if (spinTime >= spinTimeTotal) {
    stopRotateWheel();
    return;
  }
  let spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
  startAngle += (spinAngle * Math.PI) / 180;
  drawWheel();
  spinTimeout = setTimeout(rotateWheel, 30);
}

function stopRotateWheel() {
  clearTimeout(spinTimeout);
  // 화살표가 위를 가리키므로 270도 보정
  const degrees = (startAngle * 180) / Math.PI + 270;
  const arcd = (arc * 180) / Math.PI;
  let index = Math.floor((360 - (degrees % 360)) / arcd);
  index = index % segments.length;  // 범위 내 보정
  const selected = segments[index];
  resultDiv.textContent = `🎉 축하합니다! 당첨: ${selected}`;
  showFireworks();
}

function easeOut(t, b, c, d) {
  const ts = (t /= d) * t;
  const tc = ts * t;
  return b + c * (tc + -3 * ts + 3 * t);
}

function showFireworks() {
  const container = document.getElementById("container");
  const fw = document.createElement("div");
  fw.className = "firework";
  fw.style.left = centerX - 75 + "px";
  fw.style.top = centerY - 75 + "px";
  container.appendChild(fw);

  setTimeout(() => {
    fw.remove();
  }, 1000);
}

spinBtn.addEventListener("click", () => {
  if (!isSpinning) {
    isSpinning = true;
    resultDiv.textContent = "";
    spin();
    setTimeout(() => {
      isSpinning = false;
    }, 7000);
  }
});

drawWheel();
</script>
</body>
</html>
